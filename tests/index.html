<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>hello phaser!</title>
        <script src="//cdn.jsdelivr.net/phaser/2.5.0/phaser.min.js"></script>
    </head>
    <body style="padding:0px; margin:0px;">

    <script type="text/javascript">

	function getJsonFromUrl() {
	  var query = location.search.substr(1);
	  var result = {};
	  query.split("&").forEach(function(part) {
		var item = part.split("=");
		result[item[0]] = decodeURIComponent(item[1]);
	  });
	  return result;
	}

    window.onload = function() {

		var toolbarSz = 50;
		var gameWidth = window.innerWidth-1;
		var gameHeight = window.innerHeight-1-toolbarSz;

		
		var game = new Phaser.Game(gameWidth, gameHeight+toolbarSz, Phaser.AUTO, 'phaser-example', { preload: preload, create: create, update: update, render: render });
		
		function preload() {

			game.load.image('arrow', 'arrow.png');
			game.load.image('buttonPlus','set1/plus.png');
			game.load.image('buttonMinus','set1/minus.png');
			game.load.image('buttonAdd','set1/file_add.png');
			game.load.image('buttonSearch','set1/file_search.png');
		}


		var contra;
		var padd = 20;
		var finalImageWidth = Math.min(gameWidth/3, gameHeight/3) - padd*2;
		var move = true;
		var speed = 6;
		var urlData = getJsonFromUrl();
		var buttonTopL, buttonTopM, buttonTopR, buttonMiddleL, buttonMiddleR, buttonBottomL, buttonBottomM, buttonBottomR;
		var floor;
		
		if(urlData["speed"] != undefined)
		{
			speed = urlData["speed"];
		}
		
		function create() {

			//	Enable p2 physics
			game.physics.startSystem(Phaser.Physics.P2JS);
			
			key1 = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
			key1.onDown.add(onClick, this);
			
			key2 = game.input.keyboard.addKey(Phaser.Keyboard.ENTER);
			key2.onDown.add(onClick, this);
			game.input.onTap.add(onClick, this);
			floor = new Phaser.Rectangle(0, gameHeight, gameWidth, gameHeight+toolbarSz);

			var posTLx = (gameWidth/3)/2  - (gameWidth/4)/2;
			var posTLy = (gameHeight/3)/2 - (gameHeight/4)/2;
			
			buttonTopL = game.add.button(padd, padd, 'buttonPlus', null, this, 0, 0, 0);
			buttonTopM = game.add.button(gameWidth/2 - finalImageWidth/2, padd, 'buttonMinus', null, this, 0, 0, 0);
			buttonTopR = game.add.button(gameWidth - finalImageWidth - padd, padd, 'buttonPlus', null, this, 0, 0, 0);
						
			buttonMiddleL = game.add.button(padd, gameHeight/2 - finalImageWidth/2, 'buttonAdd', null, this, 0, 0, 0);
			buttonMiddleR = game.add.button(gameWidth - finalImageWidth - padd, gameHeight/2 - finalImageWidth/2, 'buttonSearch', null, this, 0, 0, 0);
			
			buttonBottomL = game.add.button(padd, gameHeight - finalImageWidth - padd, 'buttonMinus', null, this, 0, 0, 0);
			buttonBottomM = game.add.button(gameWidth/2 - finalImageWidth/2, gameHeight - finalImageWidth - padd, 'buttonPlus', null, this, 0, 0, 0);
			buttonBottomR = game.add.button(gameWidth - finalImageWidth - padd, gameHeight - finalImageWidth - padd, 'buttonMinus', null, this, 0, 0, 0);
			
			ResizeButton(buttonTopL, finalImageWidth);
			ResizeButton(buttonTopM, finalImageWidth);
			ResizeButton(buttonTopR, finalImageWidth);
			
			ResizeButton(buttonMiddleL, finalImageWidth);
			ResizeButton(buttonMiddleR, finalImageWidth);
			
			ResizeButton(buttonBottomR, finalImageWidth);
			ResizeButton(buttonBottomM, finalImageWidth);
			ResizeButton(buttonBottomL, finalImageWidth);
			
			//buttonBottomL.tint = 0xffffff;
			
			contra = game.add.sprite(gameWidth/2,gameHeight/2, 'arrow');
			//Enable the physics body on this sprite and turn off the visual debugger
			game.physics.p2.enable(contra, true);
						
			//100% W is 1152px
			var minProportion = Math.min(gameWidth, gameHeight);
			var arrowProportion = minProportion / 950;
			
			//	Clear the shapes and load the 'arrow' polygon from the physicsData JSON file in the cache
			contra.body.clearShapes();
			contra.scale.setTo(arrowProportion, arrowProportion);
		}
		
		function ResizeButton(button, width)
		{
			//100% of images should be finalImageWidth
			//calculate maximum image (width or height)
			var maxImg = Math.max(button.width, button.height);
			var proportion = width/maxImg;
			
			button.scale.setTo(proportion, proportion);
			//now, reposition the button
			//calculate change difference of width to the final width:
			//var newWidthDiference = width*proportion - width;
			//var newHeightDiference = width*proportion - width;
			
			//button.x = button.x + newWidthDiference/4;
			//button.y = button.y + newHeightDiference/4;
		}

		function onClick()
		{
			// this is how you load an image dinamically and change the sprite
			//this.game.load.image('profilepic','http://www.w3school.com.cn/i/ct_html5_canvas_image.gif');
			//contra.loadTexture('profilepic', 0);
			
			//contra.frameName = 'ct_html5_canvas_image.gif';
			//contra.key = 'profilepico';
			
			move = !move;
			if (move == false)
			{
				contra.body.rotateRight(0);
				//if we stopped, we should show whatever image is selected!
				
				
			}
		}
		
		
		function update() {

			if (move)
			{
				contra.body.rotateRight(speed);
			}

		}

		function render() {
			game.debug.geom(floor,'rgba(255,255,255, 0.8)');
		}
    };

    </script>

    </body>
</html>